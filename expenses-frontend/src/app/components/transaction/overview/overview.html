<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>–û–≥–ª—è–¥</h3>
    <div class="d-flex gap-2">
      <button class="btn btn-success btn-sm" (click)="openCreate('EXPENSE')">+ –í–∏—Ç—Ä–∞—Ç–∞</button>
      <button class="btn btn-success btn-sm" (click)="openCreate('INCOME')">+ –î–æ—Ö—ñ–¥</button>
    </div>
  </div>

  @if (loading) {
    <div class="text-center py-5"><div class="spinner-border text-primary"></div></div>
  } @else if (errorMessage) {
    <div class="alert alert-danger">{{ errorMessage }}</div>
  } @else {
    <div class="row g-3">
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm rounded">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>üìâ –í–∏—Ç—Ä–∞—Ç–∏</span>
            <span class="fw-semibold text-danger">‚àí{{ totalExpenses | currency:' UAH ' }}</span>
          </div>
          <div class="card-body p-0">
            @if (expenses.length) {
              <div class="table-responsive">
                <table class="table custom-table align-middle mb-0">
                  <thead><tr><th>–î–∞—Ç–∞</th><th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th><th>–û–ø–∏—Å</th><th class="text-end">–°—É–º–∞</th><th class="text-center">–î—ñ—ó</th></tr></thead>
                  <tbody>
                    @for (t of expenses; track t.id) {
                      <tr>
                        <td>{{ t.date | date:'dd.MM.yyyy' }}</td>
                        <td><span class="badge px-3 py-2 d-inline-flex align-items-center gap-1"
                          [ngStyle]="{ color: getCategoryStyle(t.categoryName!).color, background: getCategoryStyle(t.categoryName!).bg }">
                        <span class="me-1">{{ getCategoryStyle(t.categoryName!).icon }}</span>    {{ t.categoryName }} </span>
                        </td>
                        <td>{{ t.description }}</td>
                        <td class="text-end fw-bold text-danger">-{{ t.amount | currency:' UAH ':'symbol':'1.2-2' }}</td>
                        <td class="text-center">
                          <button class="btn btn-sm btn-primary btn-action me-2" (click)="openEdit(t)" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è
                            <span class="bi bi-pencil-square fs-5 text-primary"></span>
                          </button>
                          <button class="btn btn-sm btn-danger btn-action" (click)="confirmDelete(t)" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è
                            <span class="bi bi-trash fs-5 text-danger"></span>
                          </button>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            } @else { <div class="p-3 text-muted">–ó–∞–ø–∏—Å—ñ–≤ –Ω–µ–º–∞—î</div> }
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card shadow-sm rounded">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>üìà –î–æ—Ö–æ–¥–∏</span>
            <span class="fw-semibold text-success">+{{ totalIncomes | currency:' UAH ' }}</span>
          </div>
          <div class="card-body p-0">
            @if (incomes.length) {
              <div class="table-responsive">
                <table class="table custom-table align-middle mb-0">
                  <thead><tr><th>–î–∞—Ç–∞</th><th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th><th>–û–ø–∏—Å</th><th class="text-end">–°—É–º–∞</th><th class="text-center">–î—ñ—ó</th></tr></thead>
                  <tbody>
                    @for (t of incomes; track t.id) {
                      <tr>
                        <td>{{ t.date | date:'dd.MM.yyyy' }}</td>
                        <td><span class="badge px-3 py-2 d-inline-flex align-items-center gap-1"
                          [ngStyle]="{ color: getCategoryStyle(t.categoryName!).color, background: getCategoryStyle(t.categoryName!).bg }">
                        <span class="me-1">{{ getCategoryStyle(t.categoryName!).icon }}</span>    {{ t.categoryName }} </span>
                        </td>
                        <td>{{ t.description }}</td>
                        <td class="text-end fw-bold text-success">+{{ t.amount | currency:' UAH ':'symbol':'1.2-2' }}</td>
                        <td class="text-center">
                          <button class="btn btn-sm btn-primary btn-action me-2" (click)="openEdit(t)" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è
                            <span class="bi bi-pencil-square fs-5 text-primary"></span>
                          </button>
                          <button class="btn btn-sm btn-danger btn-action" (click)="confirmDelete(t)" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è
                            <span class="bi bi-trash fs-5 text-danger"></span>
                          </button>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            } @else { <div class="p-3 text-muted">–ó–∞–ø–∏—Å—ñ–≤ –Ω–µ–º–∞—î</div> }
          </div>
        </div>
      </div>
    </div>
  }

  <app-transaction-form-modal
    [visible]="modalVisible"
    [transaction]="editing"
    [presetType]="presetType"
    (close)="onCloseModal()"
    (save)="save($event)">
  </app-transaction-form-modal>
</div>
